<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Arab Security Cyber WarGames 2022 - Youssef Hesham - Software, security and chess </title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta property="og:site_name" content="Youssef Hesham - Software, security and chess"><meta property="og:locale" content="en_US"><meta property="og:url" content="/blog/arab-security-cyber-wargames-2022/"><meta property="og:site_name" content="Youssef Hesham - Software, security and chess"><meta property="og:title" content="Arab Security Cyber WarGames 2022"><meta property="og:description" content="OSP Challenge Have you heard of OTP? This is OSP (One Secret Password).
given an osp.py that contains the following block of code.
from Crypto.Util.number import getPrime, long_to_bytes, bytes_to_long, isPrime from string import printable, ascii_letters from secret import FLAG import os secret = os.urandom(len(FLAG)) def OSP(plain, secret): assert len(plain) == len(secret), 'The length has to be idenntical!' ct = [] p = getPrime(256) for f, k in zip(FLAG, secret): ct.append((f * p + k)) return ct, p ct, p = OSP(FLAG, secret) print(ct) And given a text file output.txt that contains the flag encrypted:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-08-08T12:00:00+00:00"><meta property="article:modified_time" content="2022-08-08T12:00:00+00:00"><meta property="article:tag" content="Ctf"><meta property="article:tag" content="Writeup"><meta property="article:tag" content="Ascwg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Arab Security Cyber WarGames 2022"><meta name=twitter:description content="Youssef's personal website/Blog. tech, opinions and chess."><meta name=twitter:image content="/"><link rel=canonical href=/blog/arab-security-cyber-wargames-2022/><link rel=stylesheet href=/css/site.min.css><link rel=stylesheet href=/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=/img/fav/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/fav/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/fav/favicon-16x16.png><link rel=manifest href=/img/fav/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><div class="mt-xl header"><header><div class=container><div class="row justify-content-center"><div class=col-auto><a href=/ style=display:contents><h1 class="name text-center">Youssef Hesham</h1></a></div></div><div class="row justify-content-center"><div class="nav justify-content-center"><ul><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=/>~/</a></li><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=/about>About</a></li><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=https://github.com/iossefy>Github</a></li><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=/index.xml>rss</a></li></ul></div></div></div></header></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">Arab Security Cyber WarGames 2022</h1><div class="meta-data meta"><span class="author meta-data" title="Youssef Hesham">Youssef Hesham
</span><span class="date middot meta-data" title='Mon Aug 8 2022 12:00:00 UTC'>2022-08-08
</span><span class="reading-time middot meta-data">3 min read
</span><a class="middot meta-data" href=/blog/arab-security-cyber-wargames-2022/>Permalink</a><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class=d-inline style=margin-right:.5rem><a href=/tags/ctf>#ctf</a></li><li class=d-inline style=margin-right:.5rem><a href=/tags/writeup>#writeup</a></li><li class=d-inline style=margin-right:.5rem><a href=/tags/ascwg>#ascwg</a></li></ul></div></div><div class="markdown blog-post-content"><h3 id=osp-challenge>OSP Challenge</h3><blockquote><p>Have you heard of OTP? This is OSP (One Secret Password).</p></blockquote><p>given an <code>osp.py</code> that contains the following block of code.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>Crypto.Util.number</span> <span style=color:#080;font-weight:700>import</span> getPrime, long_to_bytes, bytes_to_long, isPrime
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>string</span> <span style=color:#080;font-weight:700>import</span> printable, ascii_letters
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>secret</span> <span style=color:#080;font-weight:700>import</span> FLAG
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>secret <span style=color:#333>=</span> os<span style=color:#333>.</span>urandom(<span style=color:#007020>len</span>(FLAG))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>OSP</span>(plain, secret):
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>assert</span> <span style=color:#007020>len</span>(plain) <span style=color:#333>==</span> <span style=color:#007020>len</span>(secret), <span style=background-color:#fff0f0>&#39;The length has to be idenntical!&#39;</span>
</span></span><span style=display:flex><span>    ct <span style=color:#333>=</span> []
</span></span><span style=display:flex><span>    p <span style=color:#333>=</span> getPrime(<span style=color:#00d;font-weight:700>256</span>)
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>for</span> f, k <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>zip</span>(FLAG, secret):
</span></span><span style=display:flex><span>        ct<span style=color:#333>.</span>append((f <span style=color:#333>*</span> p <span style=color:#333>+</span> k))
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> ct, p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ct, p <span style=color:#333>=</span> OSP(FLAG, secret)
</span></span><span style=display:flex><span><span style=color:#007020>print</span>(ct)
</span></span></code></pre></div><p>And given a text file <code>output.txt</code> that contains the flag encrypted:</p><pre>
5447072546591309544167389173397699795993168970119080464536675615517059887871841
6955492636416595264090666175261678201037431146459748900869908862891014933743799
5614674778794119068603308840271475174331420323045821401907034865225277115190905
7290697100822214312962505509009228957713933852313230775610627362307449388382150
5949879243199738117475148174019025931007923028899303276647753364641711569829134
10307537280472785752809059512737185767802458204994567648277093857055359480126320
7290697100822214312962505509009228957713933852313230775610627362307449388382014
8715316074546095270667822677436319673589070352190528743258680984827295820594564
4357658037273047635333911338718159836794535176095264371629340492413647910297392
4609061385577261921987790839028822904301912205485375777684879366975973751276187
7961106029633452410706184176504330471066939264020194525092064361140318297658489
4106254688968833348680031838407496769287158146705152965573801617851322069318627
8547713842343285746231903010562544295250818999263787805888321735119078593275661
7961106029633452410706184176504330471066939264020194525092064361140318297658510
4106254688968833348680031838407496769287158146705152965573801617851322069318692
4609061385577261921987790839028822904301912205485375777684879366975973751276175
3268243527954785726500433504038619877595901382071448278722005369310235932723134
9637128351661547655065380845242084254449452793287603898795656858222490570849839
7961106029633452410706184176504330471066939264020194525092064361140318297658493
6536487055909571453000867008077239755191802764142896557444010738620471865445985
4022453572867428586462072004970609080118032470241782496888621992997213455659123
4609061385577261921987790839028822904301912205485375777684879366975973751276211
7961106029633452410706184176504330471066939264020194525092064361140318297658707
5363271430489904781949429339960812106824043293655709995851495990662951274212211
7961106029633452410706184176504330471066939264020194525092064361140318297658649
6704089288112380977436786674951015133530054117069637494814369988328689092765262
9553327235560142892847421011805196565280327116824233430110477233368381957190188
4106254688968833348680031838407496769287158146705152965573801617851322069318653
6452685939808166690782907174640352066022677087679526088758831113766363251786487
4273856921171642873115951505281272147625409499631893902944160867559539296637772
2765436831346357153192674503417293742581147323291225466610927620185584250765693
3771050224563214299808192504659946012610655440851671090833083118434887614680427
8547713842343285746231903010562544295250818999263787805888321735119078593275529
4022453572867428586462072004970609080118032470241782496888621992997213455659182
8547713842343285746231903010562544295250818999263787805888321735119078593275562
8547713842343285746231903010562544295250818999263787805888321735119078593275594
8128708261836261935142103843378105849405190616946935462462423610848535524977837
4273856921171642873115951505281272147625409499631893902944160867559539296637945
4525260269475857159769831005591935215132786529022005308999699742121865137616416
4441459153374452397551871172155047525963660852558634840314520117267756523956886
4609061385577261921987790839028822904301912205485375777684879366975973751276006
8463912726241880984013943177125656606081693322800417337203142110264969979616102
10475139512675595277244979179610961146140709557921308585647453106763576707445416
</pre><h3 id=my-approach-solving-the-challange>My approach solving the challange</h3><p>first thing i do is i try to collect as much information as possible from the
given code. by looking at <code>output.txt</code> you can see that most of the lines are
of length 79. while there are two lines that differs from the rest, they have
the length of 80.</p><p>the function <code>OSP(plain, secret)</code> takes byte array (b"array")
and secret (random bytes with the length equals to the flag&rsquo;s length) and
returns the used prime number and <code>ct</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>OSP</span>(plain, secret):
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>assert</span> <span style=color:#007020>len</span>(plain) <span style=color:#333>==</span> <span style=color:#007020>len</span>(secret), <span style=background-color:#fff0f0>&#39;The length has to be idenntical!&#39;</span>
</span></span><span style=display:flex><span>    ct <span style=color:#333>=</span> []
</span></span><span style=display:flex><span>    p <span style=color:#333>=</span> getPrime(<span style=color:#00d;font-weight:700>256</span>)
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>for</span> f, k <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>zip</span>(FLAG, secret):
</span></span><span style=display:flex><span>        ct<span style=color:#333>.</span>append((f <span style=color:#333>*</span> p <span style=color:#333>+</span> k))
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> ct, p
</span></span></code></pre></div><p>by just looking you can identify the most important part in it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#888>#...</span>
</span></span><span style=display:flex><span>p <span style=color:#333>=</span> getPrime(<span style=color:#00d;font-weight:700>256</span>)
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>for</span> f, k <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>zip</span>(FLAG, secret):
</span></span><span style=display:flex><span>    ct<span style=color:#333>.</span>append((f <span style=color:#333>*</span> p <span style=color:#333>+</span> k))
</span></span><span style=display:flex><span><span style=color:#888>#...</span>
</span></span></code></pre></div><p>Trying the <code>OSP()</code> function to see how it works.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>FLAG <span style=color:#333>=</span> <span style=background-color:#fff0f0>b</span><span style=background-color:#fff0f0>&#39;A&#39;</span>
</span></span><span style=display:flex><span>secret <span style=color:#333>=</span> os<span style=color:#333>.</span>urandom(<span style=color:#007020>len</span>(FLAG))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ct, p <span style=color:#333>=</span> OSP(FLAG, secret)
</span></span></code></pre></div><p><code>f</code> is the ord(&lsquo;A&rsquo;), <code>p</code> is a prime number and <code>k</code> is a random byte and it will
result in
<code>56935293674359....900212209796131672</code>
of length 79 now i know where is the 79 chars came from.</p><p>i wrote this function to decrypt needing only the prime number.
By just doing the opposite of what the encrypt function is doing.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#888># decrypts and returns ASCII char</span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>decrypt</span>(ctx, prime) <span style=color:#333>-&gt;</span> <span style=color:#007020>int</span>:
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> <span style=color:#007020>int</span>((ctx<span style=color:#333>-</span><span style=color:#007020>len</span>(<span style=color:#007020>str</span>(ctx)))<span style=color:#333>/</span>prime)
</span></span></code></pre></div><p>where <code>ctx</code> is <code>f</code>. <code>len(str(ctx))</code> is <code>k</code> and <code>prime</code> is <code>p</code> from the <code>OSP()</code> function</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#007020>int</span>(
</span></span><span style=display:flex><span>    (ctx <span style=color:#333>-</span> <span style=color:#007020>len</span>(<span style=color:#007020>str</span>(ctx) )) <span style=color:#333>/</span> prime
</span></span><span style=display:flex><span> )
</span></span></code></pre></div><p>calling this: <code>decrypt(ct[0], p)</code> returns 65 == ord(&lsquo;A&rsquo;) which is our flag!</p><p>the method this encryption function get&rsquo;s its prime number is by <code>p = getPrime(N)</code></p><p>i know the <code>N</code>. so i went on to bruteforce the prime number. and this is my code
to do it.</p><h2 id=solution>Solution</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>Crypto.Util.number</span> <span style=color:#080;font-weight:700>import</span> getPrime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888># as from the OSP() function</span>
</span></span><span style=display:flex><span><span style=color:#888># &gt;&gt; p = getPrime(256)</span>
</span></span><span style=display:flex><span>BIT_LEN <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>256</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888># decrypts and returns ASCII char</span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>decrypt</span>(ctx, prime) <span style=color:#333>-&gt;</span> <span style=color:#007020>int</span>:
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> <span style=color:#007020>int</span>((ctx<span style=color:#333>-</span><span style=color:#007020>len</span>(<span style=color:#007020>str</span>(ctx)))<span style=color:#333>/</span>prime)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888># read output.txt (encrypted data) file</span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>with</span> <span style=color:#007020>open</span>(<span style=background-color:#fff0f0>&#34;output.txt&#34;</span>, <span style=background-color:#fff0f0>&#39;r&#39;</span>) <span style=color:#080;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>    out <span style=color:#333>=</span> f<span style=color:#333>.</span>readlines()
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#007020>len</span>(out)):
</span></span><span style=display:flex><span>        out[i] <span style=color:#333>=</span> out[i]<span style=color:#333>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888># I know that the flag starts with ASCWG{</span>
</span></span><span style=display:flex><span>flag_pfx <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;ASCWG{&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>solve</span>(prime) <span style=color:#333>-&gt;</span> <span style=color:#007020>str</span>:
</span></span><span style=display:flex><span>    flag <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#007020>len</span>(out)):
</span></span><span style=display:flex><span>        flag <span style=color:#333>+=</span> <span style=color:#007020>chr</span>(decrypt(<span style=color:#007020>int</span>(out[i]), prime))
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> flag
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#333>=</span> getPrime(BIT_LEN)
</span></span><span style=display:flex><span>ret <span style=color:#333>=</span> solve(p)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888># Bruteforce prime number</span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>while</span> flag_pfx <span style=color:#000;font-weight:700>not</span> <span style=color:#000;font-weight:700>in</span> ret:
</span></span><span style=display:flex><span>    p <span style=color:#333>=</span> getPrime(BIT_LEN)
</span></span><span style=display:flex><span>    ret <span style=color:#333>=</span> solve(p)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020>print</span>(<span style=background-color:#fff0f0>f</span><span style=background-color:#fff0f0>&#34;prime: </span><span style=background-color:#eee>{</span>p<span style=background-color:#eee>}</span><span style=background-color:#fff0f0>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#007020>print</span>(<span style=background-color:#fff0f0>f</span><span style=background-color:#fff0f0>&#34;flag length: </span><span style=background-color:#eee>{</span><span style=color:#007020>len</span>(ret)<span style=background-color:#eee>}</span><span style=background-color:#fff0f0>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#007020>print</span>(<span style=background-color:#fff0f0>f</span><span style=background-color:#fff0f0>&#34;flag: </span><span style=background-color:#eee>{</span>ret<span style=background-color:#eee>}</span><span style=background-color:#fff0f0>&#34;</span>)
</span></span></code></pre></div><pre>
$ python solve.py
prime: 83614740067651512734468706.....00802220121111201
flag length: 43
flag: ASCWG{Wh47_1f_17's_N07_@_Pr1M3!-f0ffa3657e}
</pre></div></div><hr class=footer-linebreak><div class=container><span class="row justify-content-center meta" id=footer>Copyright © 2025 Youssef Hesham
</span><script defer src=/js/custom.js></script></div></div></div></div></body></html>